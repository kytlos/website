---
import { getLangFromUrl } from '../i18n/utils';

const currentLang = getLangFromUrl(Astro.url);
const base = import.meta.env.BASE_URL || '/';

// Get the current page path without the base and language prefix
let pathname = Astro.url.pathname;
if (base !== '/' && pathname.startsWith(base)) {
  pathname = pathname.slice(base.length - 1); // Keep leading slash
}
const pathWithoutLang = pathname.replace(/^\/(en|it)/, '') || '/';

// Generate language URLs with base path
const enUrl = currentLang === 'en'
  ? `${base === '/' ? '' : base.slice(0, -1)}${pathname}`
  : `${base === '/' ? '' : base.slice(0, -1)}${pathWithoutLang}`;
const itUrl = currentLang === 'it'
  ? `${base === '/' ? '' : base.slice(0, -1)}${pathname}`
  : `${base === '/' ? '' : base.slice(0, -1)}/it${pathWithoutLang}`;
---

<div class="flex items-center gap-1 bg-gray-100 rounded-md p-1">
  <a
    href={enUrl}
    class:list={[
      'px-3 py-1.5 rounded text-sm font-semibold transition-all',
      currentLang === 'en'
        ? 'bg-white text-black shadow-sm'
        : 'text-gray-600 hover:text-black'
    ]}
    aria-label="Switch to English"
    aria-current={currentLang === 'en' ? 'true' : undefined}
  >
    EN
  </a>
  <a
    href={itUrl}
    class:list={[
      'px-3 py-1.5 rounded text-sm font-semibold transition-all',
      currentLang === 'it'
        ? 'bg-white text-black shadow-sm'
        : 'text-gray-600 hover:text-black'
    ]}
    aria-label="Passa all'italiano"
    aria-current={currentLang === 'it' ? 'true' : undefined}
  >
    IT
  </a>
</div>
